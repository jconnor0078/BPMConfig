@model DealerCreateViewModel
<!--Begin MiniHeaderForAllPages-->
@Html.Partial("_MiniHeaderForAllPages", Model.miniHeader)


<div class="clearfix">
</div>


<!-- BEGIN PAGE CONTENT-->
<div class="row">
    <div class="col-md-12">
        <div class="portlet box blue" id="form_wizard_1">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i> Creación de Nuevo Dealer - <span class="step-title">
                        Paso 1 of 4
                    </span>
                </div>
                <div class="tools hidden-xs">
                    <a href="javascript:;" class="collapse">
                    </a>
                    <a href="#portlet-config" data-toggle="modal" class="config">
                    </a>
                    <a href="javascript:;" class="reload">
                    </a>
                    <a href="javascript:;" class="remove">
                    </a>
                </div>
            </div>
            <div class="portlet-body form">
                @using (Html.BeginForm("Create", "Dealer", FormMethod.Post, new { id = "submit_form", @class = "form-horizontal" }))
                {

                    <div class="form-wizard">
                        <div class="form-body">
                            <ul class="nav nav-pills nav-justified steps">
                                <li>
                                    <a href="#tab1" data-toggle="tab" class="step">
                                        <span class="number">
                                            1
                                        </span>
                                        <span class="desc">
                                            <i class="fa fa-check"></i> Datos Generales del Dealer
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#tab2" data-toggle="tab" class="step">
                                        <span class="number">
                                            2
                                        </span>
                                        <span class="desc">
                                            <i class="fa fa-check"></i> Contactos del Dealer
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#tab3" data-toggle="tab" class="step active">
                                        <span class="number">
                                            3
                                        </span>
                                        <span class="desc">
                                            <i class="fa fa-check"></i> Ascociaciones del Dealer
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#tab4" data-toggle="tab" class="step">
                                        <span class="number">
                                            4
                                        </span>
                                        <span class="desc">
                                            <i class="fa fa-check"></i> Confirmar Información
                                        </span>
                                    </a>
                                </li>
                            </ul>
                            <div id="bar" class="progress progress-striped" role="progressbar">
                                <div class="progress-bar progress-bar-success">
                                </div>
                            </div>
                            <div class="tab-content">
                                <div class="alert alert-danger display-none">
                                    <button class="close" data-dismiss="alert"></button>
                                    Tienes algunos errores. Favor Revisar.
                                </div>
                                <div class="alert alert-success display-none">
                                    <button class="close" data-dismiss="alert"></button>
                                    La validación del formulario fur correcta!
                                </div>

                                <div class="tab-pane active" id="tab1">

                                    <h3 class="block">Informaciones Generales del Dealer</h3>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Codigo del Dealer <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" name="DealerCode" />
                                            <span class="help-block">
                                                colocar el codigo del dealer
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            RNC <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" name="RNC" />
                                            <span class="help-block">
                                                colocar el RNC del dealer
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Nombre de Dealer <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" name="DealerName" />
                                            <span class="help-block">
                                                colocar el nombre del dealer
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Provincia <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <select name="ProvinceId" id="ProvinceId_list" class="form-control">
                                                <option value=""></option>
                                                <option value="1">Santo Domingo</option>
                                                <option value="2">Santiago</option>
                                                <option value="3">La Romana</option>
                                                <option value="4">San Pedro</option>
                                                <option value="5">San Francisco</option>
                                                <option value="6">La vega</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Presidente del Dealer <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" name="DealerPresident" />
                                            <span class="help-block">
                                                colocar el nombre del presidente del dealer
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Dirección <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <textarea class="form-control" rows="3" name="Address"></textarea>
                                            <span class="help-block">
                                                coloque la dirección del dealer
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Estado <span class="required">
                                                *
                                            </span>
                                        </label>
                                        <div class="col-md-4">
                                            <div class="radio-list">
                                                <label>
                                                    <input type="radio" name="Status" value="true" data-title="Activo" />
                                                    Activo
                                                </label>
                                                <label>
                                                    <input type="radio" name="Status" value="false" data-title="Inactivo" />
                                                    Inactivo
                                                </label>
                                            </div>
                                            <div id="form_Status_error">
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="tab-pane" id="tab2">
                                    <h3 class="block">Contactos del Dealer</h3>
                                    <span id="errorAddContact" style="color:red"></span>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Nombre
                                        </label>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" id="txtContactName" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Tipo de contacto</label>
                                        <div class="col-md-4">
                                            <select id="ddContactType" class="form-control">
                                                <option value="0"></option>
                                                <option value="1">Santo Domingo</option>
                                                <option value="2">Santiago</option>
                                                <option value="3">La Romana</option>
                                                <option value="4">San Pedro</option>
                                                <option value="5">San Francisco</option>
                                                <option value="6">La vega</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">
                                            Descripción
                                        </label>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" id="txtContactDesc" />
                                        </div>
                                    </div>
                                    <div class="form-group last">
                                        <label class="control-label col-md-3"></label>
                                        <div class="col-md-4">
                                            <button type="button"  onclick="AddContacts()"  class="btn green">
                                                Agregar <i class="fa fa-share"></i>
                                            </button>
                                        </div>
                                    </div>
                   

                                    <div class="portlet">
                                        <div class="portlet-title">
                                            <div class="caption">
                                                <i class="icon-user"></i>Contactos Agregados
                                            </div>
                                            <div class="tools">
                                                <a href="javascript:;" class="collapse">
                                                </a>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <div class="table-scrollable">
                                                <table id="tableContact" class="table table-striped table-bordered table-advance table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>
                                                                <i class="fa fa-briefcase"></i> Nombre
                                                            </th>
                                                            <th>
                                                                <i class="fa fa-bookmark"></i> Tipo de Contacto
                                                            </th>
                                                            <th class="hidden-xs">
                                                                <i class="fa fa-question"></i> Descrition
                                                            </th>

                                                            <th>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="bodyTable_tabeContact"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END SAMPLE TABLE PORTLET-->
                                </div>

                                <div class="tab-pane" id="tab3">
                                    <h3 class="block">Asociacines del Dealer</h3>
                                    <span id="errorAddContact" style="color:red"></span>

                                    <div class="form-group">
                                        <label class="control-label col-md-3">Asociación</label>
                                        <div class="col-md-5">
                                            <select id="ddAssociation" class="form-control select2me" data-placeholder="Select...">
                                                <option value="1">Alabama</option>
                                                <option value="2">Wyoming</option>
                                                <option value="3">es</option>
                                                <option value="4">dd</option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group last">
                                        <label class="control-label col-md-3"></label>
                                        <div class="col-md-4">
                                            <button type="button" onclick="AddAssociation()" class="btn green">
                                                Agregar <i class="fa fa-share"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="portlet">
                                        <div class="portlet-title">
                                            <div class="caption">
                                                <i class="icon-user"></i>Contactos Agregados
                                            </div>
                                            <div class="tools">
                                                <a href="javascript:;" class="collapse">
                                                </a>
                                            </div>
                                        </div>
                                        <div class="portlet-body">
                                            <div class="table-scrollable">
                                                <table id="tableAssociation" class="table table-striped table-bordered table-advance table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>
                                                                <i class="fa fa-briefcase"></i> Id
                                                            </th>
                                                            <th>
                                                                <i class="fa fa-bookmark"></i> Asociación
                                                            </th>

                                                            <th>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="bodyTable_tabeAssociation"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END SAMPLE TABLE PORTLET-->
                                </div>

                                <div class="tab-pane" id="tab4">
                                    <h3 class="block">Confirmación de los datos del nuevo dealer</h3>
                                    <h4 class="form-section">Datos Generales</h4>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Username:</label>
                                        <div class="col-md-4">
                                            <p class="form-control-static" data-display="DealerCode">
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">RNC:</label>
                                        <div class="col-md-4">
                                            <p class="form-control-static" data-display="RNC">
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Presidente del Dealer:</label>
                                        <div class="col-md-4">
                                            <p class="form-control-static" data-display="DealerPresident">
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Dirección:</label>
                                        <div class="col-md-4">
                                            <p class="form-control-static" data-display="Address">
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Provincia:</label>
                                        <div class="col-md-4">
                                            <p class="form-control-static" data-display="ProvinceId">
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">Estado:</label>
                                        <div class="col-md-4">
                                            <p class="form-control-static" data-display="Status">
                                            </p>
                                        </div>
                                    </div>





                                    <h4 class="form-section">Contactos del Dealer</h4>
                                    <table id="tableContactInfo" class="table table-striped table-bordered table-advance table-hover">
                                        <thead>
                                            <tr>
                                                <th>
                                                    Nombre
                                                </th>
                                                <th>
                                                    Tipo de Contacto
                                                </th>
                                                <th>
                                                    Descripción
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>


                                    <h4 class="form-section">Asociaciones del Dealer</h4>
                                    <table id="tableAssociationInfo" class="table table-striped table-bordered table-advance table-hover">
                                        <thead>
                                            <tr>
                                                <th>
                                                    Id
                                                </th>
                                                <th>
                                                    Asociación
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                     
                                </div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <div class="row">
                                <div class="col-md-offset-3 col-md-9">
                                    <a href="javascript:;" class="btn default button-previous">
                                        <i class="m-icon-swapleft"></i> Atras
                                    </a>
                                    <a href="javascript:;" onclick="fillInfo()" class="btn blue button-next">
                                        Continuar <i class="m-icon-swapright m-icon-white"></i>
                                    </a>
                                    <button data-ajax="true" type="submit" class="btn green button-submit">
                                        Enviar <i class="m-icon-swapright m-icon-white"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<!-- END PAGE CONTENT-->

@section Scripts{
    <script>

        $(document).ready(function () {

            $('#tableContactInfo').DataTable();

            $('#tableAssociationInfo').DataTable();
        });

        function AddContacts() {

            //limpiar span
            var spans = $('#errorAddContact');
            spans.text(''); // clear the text

            var nombre = document.getElementById('txtContactName').value;

            var desc = document.getElementById('txtContactDesc').value;

            var type = document.getElementById('ddContactType').options[document.getElementById('ddContactType').selectedIndex].text;

            //validando
            if (nombre === "" || nombre == null) {
                spans.text('Debe ingresar un nombre.');
            } else if (type === "" || type == null || type == "0" || type == 0) {
                spans.text('Debe seleccionar un tipo de contacto.');
            } else if (desc === "" || desc == null) {
                spans.text('Debe ingresar una descripción.');
            }
            else {
                var table = document.getElementById("bodyTable_tabeContact");

                var countFila = table.rows.length - 1;
                var indexNewFila = countFila + 1;


                var tr = document.createElement("tr");
                tr.id = "tr" + indexNewFila;

                var th1 = document.createElement("th");
                th1.id = "thNombre" + indexNewFila;
                var lbl1 = document.createElement("label");
                lbl1.id = "labelNombre" + indexNewFila;
                var h1 = document.createElement("input");
                h1.type = "hidden";
                h1.value = $("#txtContactName").val();
                h1.name = "ContactList[" + indexNewFila + "].ContactName";
                lbl1.textContent = nombre;
                th1.appendChild(lbl1);
                th1.appendChild(h1);

                var th2 = document.createElement("th");
                th2.id = "thTipo" + indexNewFila;
                var lbl2 = document.createElement("label");
                lbl2.id = "labelTipo" + indexNewFila;
                var h2 = document.createElement("input");
                h2.type = "hidden";
                h2.name = "ContactList[" + indexNewFila + "].ContactTypeId";
                h2.value = $("#ddContactType").val();
                lbl2.textContent = type;
                th2.appendChild(lbl2);
                th2.appendChild(h2);

                var th3 = document.createElement("th");
                th3.id = "thDescription" + indexNewFila;
                var lbl3 = document.createElement("label");
                lbl3.id = "labelDescription" + indexNewFila;
                lbl3.textContent = desc;
                var h3 = document.createElement("input");
                h3.type = "hidden";
                h3.value = $("#txtContactDesc").val();
                h3.name = "ContactList[" + indexNewFila + "].ContactDesc";
                th3.appendChild(lbl3);
                th3.appendChild(h3);

                var th4 = document.createElement("th");
                th4.id = "thButton" + indexNewFila;
                var buton = document.createElement("div");
                buton.innerHTML = '<button onclick="deleteElement(' + indexNewFila + ')" type="button" class="btn btn- danger">Eliminar</button>';


                th4.appendChild(buton);

                tr.appendChild(th1);
                tr.appendChild(th2);
                tr.appendChild(th3);
                tr.appendChild(th4);

                table.appendChild(tr);

                clearAll();

            }




        };

        function clearAll() {
            $("#txtContactName").val("");
            $("#txtContactDesc").val("");
            $("#ddContactType").val(0);
        }


        function deleteElement(e) {
            $('#tr' + e).remove();
            reOrganizar();
        }

        function fillInfo() {
            var dataSet = [];
            tablaContact = document.getElementById("bodyTable_tabeContact");
            var trs = tablaContact.getElementsByTagName('tr');
            var co = trs.length;
            if (co > 0) {
                for (var i = 0; i < co; i++) {
                    var labels = trs[i].getElementsByTagName('label');
                    var tmpData = [];
                    tmpData.push(labels[0].textContent);
                    tmpData.push(labels[1].textContent);
                    tmpData.push(labels[2].textContent);
                    dataSet.push(tmpData);
                }
            }
            $('#tableContactInfo').DataTable({
                destroy: true,
                data: dataSet,
                paginate: false,
                searching: false,
                info: false,
                colums: [
                    { title: "Nombre" },
                    { title: "Tipo de Contacto" },
                    { title: "Descripción" }
                ]

            });



            var dataSet2 = [];
            tablaContact2 = document.getElementById("bodyTable_tabeAssociation");
            var trs2 = tablaContact2.getElementsByTagName('tr');
            var co2 = trs2.length;
            if (co2 > 0) {
                for (var i = 0; i < co2; i++) {
                    var labels2 = trs2[i].getElementsByTagName('label');
                    var tmpData2 = [];
                    tmpData2.push(labels2[0].textContent);
                    tmpData2.push(labels2[1].textContent);
                    dataSet2.push(tmpData2);
                }
            }
            $('#tableAssociationInfo').DataTable({
                destroy: true,
                data: dataSet2,
                paginate: false,
                searching: false,
                info: false,
                colums: [
                    { title: "Id" },
                    { title: "Asociación" }
                ]

            });
        }

        function reOrganizar() {

            var tablebody = document.getElementById("bodyTable_tabeContact");
            if (tablebody) {
                var count = tablebody.getElementsByTagName('tr').length;
                if (count != null && count > 0) {
                    var trs = tablebody.getElementsByTagName('tr');
                    for (var i = 0; i < count; i++) {

                        trs[i].id = "tr" + i;


                        var inputs = trs[i].getElementsByTagName('input');
                        inputs[0].name = "ContactList[" + i + "].ContactName";
                        inputs[1].name = "ContactList[" + i + "].ContactTypeId";
                        inputs[2].name = "ContactList[" + i + "].ContactDesc";

                        var ths = trs[i].getElementsByTagName('th');
                        ths[0].id = "thNombre" + i;
                        ths[1].id = "thTipo" + i;
                        ths[2].id = "thDescription" + i;
                        ths[3].id = "thButton" + i;

                    }
                    var trs2 = tablebody.getElementsByTagName('tr');
                    for (var i = 0; i < count; i++) {
                        var butons = trs2[i].getElementsByTagName('th');
                        butons[3].remove();

                        var th4 = document.createElement("th");
                        th4.id = "thButton" + i;
                        var buton = document.createElement("div");
                        buton.innerHTML = '<button onclick="deleteElement(' + i + ')" type="button" class="btn btn- danger">Eliminar</button>';
                        th4.appendChild(buton);
                        trs2[i].appendChild(th4);
                    }
                }
            }
        }

        function AddAssociation()
        {
            var id = document.getElementById('ddAssociation').value;

            var desc = document.getElementById('ddAssociation').options[document.getElementById('ddAssociation').selectedIndex].text;

            if (id != null && id != "" && id > 0 && desc != null && desc != "") {

                var exist = validateId(id);

                if (!exist) {
                    var table = document.getElementById("bodyTable_tabeAssociation");

                    var countFila = table.rows.length - 1;
                    var indexNewFila = countFila + 1;

                    var tr = document.createElement("tr");
                    tr.id = "trAssc" + indexNewFila;

                    var th1 = document.createElement("th");
                    th1.id = "thAsscId" + indexNewFila;
                    var lbl1 = document.createElement("label");
                    lbl1.id = "labelAsscId" + indexNewFila;
                    var h1 = document.createElement("input");
                    h1.type = "hidden";
                    h1.value = id;
                    h1.name = "DealerAssociationList[" + indexNewFila + "].DealerAssociationId";
                    lbl1.textContent = id;
                    th1.appendChild(lbl1);
                    th1.appendChild(h1);

                    var th2 = document.createElement("th");
                    th2.id = "thAsscDesc" + indexNewFila;
                    var lbl2 = document.createElement("label");
                    lbl2.id = "labelAsscDesc" + indexNewFila;
                    var h2 = document.createElement("input");
                    h2.type = "hidden";
                    h2.name = "DealerAssociationList[" + indexNewFila + "].DealerAssociationDesc";
                    h2.value = $("#ddContactType").val();
                    lbl2.textContent = desc;
                    th2.appendChild(lbl2);
                    th2.appendChild(h2);


                    var th4 = document.createElement("th");
                    th4.id = "thAsscButton" + indexNewFila;
                    var buton = document.createElement("div");
                    buton.innerHTML = '<button onclick="deleteElementAssc(' + indexNewFila + ')" type="button" class="btn btn- danger">Eliminar</button>';


                    th4.appendChild(buton);

                    tr.appendChild(th1);
                    tr.appendChild(th2);
                    tr.appendChild(th4);

                    table.appendChild(tr);
                }
            }
        }

        function deleteElementAssc(e)
        {
            $('#trAssc' + e).remove();
            reOrganizarAssc();
        }
        function reOrganizarAssc()
        {
            var tablebody = document.getElementById("bodyTable_tabeAssociation");
            if (tablebody) {
                var count = tablebody.getElementsByTagName('tr').length;
                if (count != null && count > 0) {
                    var trs = tablebody.getElementsByTagName('tr');
                    for (var i = 0; i < count; i++) {

                        trs[i].id = "trAssc" + i;


                        var inputs = trs[i].getElementsByTagName('input');
                        inputs[0].name = "DealerAssociationList[" + i + "].DealerAssociationId";
                        inputs[1].name = "DealerAssociationList[" + i + "].DealerAssociationDesc";
 

                        var ths = trs[i].getElementsByTagName('th');
                        ths[0].id = "thAsscId" + i;
                        ths[1].id = "thAsscDesc" + i;
                        ths[2].id = "thAsscButton" + i;

                    }
                    var trs2 = tablebody.getElementsByTagName('tr');
                    for (var i = 0; i < count; i++) {
                        var butons = trs2[i].getElementsByTagName('th');
                        butons[2].remove();

                        var th4 = document.createElement("th");
                        th4.id = "thAsscButton" + i;
                        var buton = document.createElement("div");
                        buton.innerHTML = '<button onclick="deleteElementAssc(' + i + ')" type="button" class="btn btn- danger">Eliminar</button>';
                        th4.appendChild(buton);
                        trs2[i].appendChild(th4);
                    }
                }
            }
        }

        function validateId(e)
        {
            var tablebody = document.getElementById("bodyTable_tabeAssociation");
            var exist = false;
            if (tablebody) {
                var trs = tablebody.getElementsByTagName('tr');
                trCount = trs.length;
                if (trCount>0) {
                    for (var i = 0; i < trCount; i++) {
                        var ths = trs[i].getElementsByTagName("th");
                        var thcount = ths.length;
                        if (thcount > 0) {
                            if (ths[0].getElementsByTagName("label")) {
                                var thToFilt = ths[0].getElementsByTagName("label");
                                if (thToFilt[0].textContent==e) {
                                    exist = true;
                                    break;
                                }
                            }
                        }
                    }
                }
              
                
            }
            return exist;
        }

    </script>
}